sudo: false

dist: trusty

language: node_js
node_js:
  - '12'

cache: yarn

install:
  - yarn --frozen-lockfile --non-interactive --no-progress

script:
  # lint
  - yarn run demo:lint:check
  - yarn run prettier:check
  # tests
  - yarn run lib:test:ci
  # build
  - yarn run lib:build:prod
  - yarn run demo:build:prod --progress=false --base-href "https://zakhenry.github.io/wireframe-svg/"
  - sed -i 's/<base href="https:\/\/zakhenry.github.io\/wireframe-svg\/">/<base href="\/">/g' dist/wireframe-svg-demo/index.html
  - cd ./dist/wireframe-svg-demo
  - nohup http-server-spa . index.html 4765 &
  - cd ../..
  - sleep 5
  - sed -i 's/<base href="\/">/<base href="https:\/\/zakhenry.github.io\/wireframe-svg\/">/g' dist/wireframe-svg-demo/index.html

  - rm dist/wireframe-svg/README.md && cp README.md dist/wireframe-svg
  - cp LICENSE dist/wireframe-svg

after_success:
  - codecov

deploy:
  - provider: script
    skip_cleanup: true
    script: yarn semantic-release
    on:
      branch: master
  - provider: pages
    skip_cleanup: true
    github_token: $GH_TOKEN
    local_dir: dist/wireframe-svg-demo
    on:
      branch: master
